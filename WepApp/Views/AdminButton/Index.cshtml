@model WepApp.Models.AdminButtonViewModel
@{
    ViewData["Title"] = "Buton Yetkilendirme";
    Layout = "~/Views/Shared/_LayoutWebAdmin.cshtml";
    // Sayfa adı çeviri sözlüğü
    var sayfaAdlari = new Dictionary<string, string>
            {
                ["AdminMusteri"] = "Müşteriler",
                ["AdminAnaSayfaBannerResim"] = "Ana Sayfa Banner",
                ["AdminBayi"] = "Bayiler",
                ["AdminARGEDurum"] = "Arge Durum",
                ["AdminArgeHata"] = "ARGE/Hata",
                ["AdminBayiDuyuru"] = "Bayi Duyurular",
                ["AdminBayiSozlesme"] = "Bayi Sözleşmesi",
                ["AdminBayiSozlesmeKriteri"] = "Bayi Sözleşme Kriteri",
                ["AdminUrun"] = "Ürünler",
                ["AdminBirim"] = "Birimler",
                ["AdminEntegrator"] = "Entegratörler",
                ["AdminButton"] = "Buton İzin",
                ["AdminKategori"] = "Kategoriler",
                ["AdminTeklif"] = "Teklifler",
                ["AdminKampanya"] = "Kampanyalar",
                ["AdminDuyuru"] = "Duyurular",
                ["AdminMakale"] = "Makaleler",
                ["AdminSertifika"] = "Sertifikalar",
                ["AdminPaket"] = "Modüller",
                ["AdminIstekOneri"] = "İstek/Öneri",
                ["AdminArge"] = "ARGE/Hata",
                ["AdminMenuIzin"] = "Menü Yetkilendirme",
                ["AdminButtonController"] = "Buton Yetkilendirme",
                ["AdminGenelAydinlatma"] = "Genel Aydınlatma Metni",
                ["AdminHakkimizdaBilgileri"] = "Hakkımızda",
                ["AdminHakkimizdaFotograf"] = "Hakkımızda Görsel",
                ["AdminIK"] = "Başvuru Formları",
                ["AdminIletisimBilgileri"] = "İletişim Bilgileri",
                ["AdminIstekOneriDurum"] = "İstek Öneri Durum",
                ["AdminKDV"] = "KDV Oranları",
                ["AdminDepartman"] = "Departman Tipleri",
                ["AdminKVKK"] = "KVKK Metni",
                ["AdminLisansDurumu"] = "Lisans Durumu",
                ["AdminLisansTip"] = "Lisans Tipleri",
                ["AdminLokasyon"] = "Lokasyonlar",
                ["AdminMusteriSozlesme"] = "Müşteri Sözleşmesi",
                ["AdminMusteriTipi"] = "Müşteri Tipleri",
                ["AdminNedenler"] = "Teklif Kaybedilme Nedenleri",
                ["AdminNeredenDuydu"] = "Nereden Duydu",
                ["AdminPaketBaglama"] = "Paket Bağlama",
                ["AdminPaketGrup"] = "Paket Grupları",
                ["AdminSSS"] = "Sıkça Sorulan Sorular",
                ["AdminTeklifDurum"] = "Teklif Durumları",
                ["AdminTeklifler"] = "Ürün Teklifleri",
                ["AdminTeklifVer"] = "Teklif Oluştur",
                ["AdminUrunGaleri"] = "Ürün Görselleri",
                ["AdminUYB"] = "Genel Ayarlar",
                ["AdminYetki"] = "Yetkilendirme"
            };

    // BUTON AKSİYONU ÇEVİRİ SÖZLÜĞÜ - SADECE İHTİYAÇ DUYULANLAR
    var butonAdlari = new Dictionary<string, dynamic>
            {
                ["create"] = new { Ad = "Ekle", Icon = "fa-hammer", Renk = "purple" },
                ["edit"] = new { Ad = "Düzenle", Icon = "fa-wrench", Renk = "orange" },
                ["delete"] = new { Ad = "Sil", Icon = "fa-eraser", Renk = "maroon" },
                ["view"] = new { Ad = "Detay", Icon = "fa-binoculars", Renk = "teal" }
            };

    // Gizlenecek controller'lar
    var gizlenecekler = new HashSet<string>(StringComparer.OrdinalIgnoreCase)
    {
        "Home",
        "AdminKullanici",
        "AdminKullanicilar",
        "AdminPaketGrupDetay",
        "_LayoutWebAdmin",
        "_LayoutWebUI",
        "InsanKaynaklari",
        "UrunDetay",
        "Shared",
        "Login"
    };
}
<style>
    /* RENK TANIMLARI - ÖZEL RENKLER */
    .bg-purple {
        background-color: #6f42c1 !important;
        color: white;
    }

    .bg-orange {
        background-color: #fd7e14 !important;
        color: white;
    }

    .bg-maroon {
        background-color: #800000 !important;
        color: white;
    }

    .bg-teal {
        background-color: #20c997 !important;
        color: white;
    }

    .bg-indigo {
        background-color: #6610f2 !important;
        color: white;
    }

    .bg-pink {
        background-color: #d63384 !important;
        color: white;
    }

    .bg-brown {
        background-color: #8b4513 !important;
        color: white;
    }

    .bg-emerald {
        background-color: #2e8b57 !important;
        color: white;
    }

    .bg-crimson {
        background-color: #dc143c !important;
        color: white;
    }

    .bg-navy {
        background-color: #000080 !important;
        color: white;
    }

    .text-purple {
        color: #6f42c1 !important;
    }

    .text-orange {
        color: #fd7e14 !important;
    }

    .text-maroon {
        color: #800000 !important;
    }

    .text-teal {
        color: #20c997 !important;
    }

    .text-indigo {
        color: #6610f2 !important;
    }

    .text-pink {
        color: #d63384 !important;
    }

    .text-brown {
        color: #8b4513 !important;
    }

    .text-emerald {
        color: #2e8b57 !important;
    }

    .text-crimson {
        color: #dc143c !important;
    }

    .text-navy {
        color: #000080 !important;
    }
    /* ANA TASARIM - SADE VE TEMİZ */
    * {
        box-sizing: border-box;
    }

    .permission-wrapper {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        padding: 15px;
        position: relative;
        padding-bottom: 100px;
    }

    .user-type-bar {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 15px;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
    }

    .user-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .stats-box {
        background: white;
        padding: 8px 15px;
        border-radius: 20px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        display: flex;
        gap: 20px;
    }

    .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .stat-value {
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1;
    }

    .stat-label {
        font-size: 0.7rem;
        color: #6c757d;
        text-transform: uppercase;
    }

    .menu-container {
        max-height: 500px;
        overflow-y: auto;
        overflow-x: hidden;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 10px;
        background: #fcfcfc;
        margin-bottom: 20px;
    }

    .menu-item {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        margin-bottom: 8px;
        transition: all 0.2s;
    }

    .menu-header {
        background: #f1f3f5;
        padding: 10px 12px;
        border-radius: 6px 6px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
    }

    .menu-title {
        display: flex;
        align-items: center;
        gap: 10px;
    }

        .menu-title i {
            color: #0d6efd;
            font-size: 1rem;
        }

        .menu-title span {
            font-weight: 600;
            color: #212529;
        }

    .badge-count {
        background: #6c757d;
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: normal;
    }

    .menu-actions {
        display: flex;
        gap: 5px;
    }

    .btn-xs {
        padding: 2px 8px;
        font-size: 0.7rem;
        border-radius: 4px;
    }

    .menu-content {
        padding: 12px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .button-chip {
        display: inline-flex;
        align-items: center;
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 20px;
        padding: 3px 8px 3px 3px;
        transition: all 0.2s;
        cursor: pointer;
    }

        .button-chip.izinli {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .button-chip input {
            margin-right: 4px;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .button-chip label {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            margin: 0;
        }

        .button-chip i {
            font-size: 0.7rem;
        }

    .action-badge {
        padding: 2px 6px;
        border-radius: 12px;
        font-size: 0.65rem;
        font-weight: 600;
    }
    /* SABİT KAYDET BUTONU */
    .fixed-save-button {
        position: fixed;
        bottom: 20px;
        right: 30px;
        z-index: 9999;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        border-radius: 50px;
    }

        .fixed-save-button .btn {
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

    .sticky-save-container {
        position: sticky;
        bottom: 0;
        background: white;
        padding: 15px 0;
        margin-top: 20px;
        border-top: 2px solid #e9ecef;
        display: flex;
        justify-content: flex-end;
        z-index: 1000;
    }
    /* Scrollbar */
    .menu-container::-webkit-scrollbar {
        width: 6px;
    }

    .menu-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .menu-container::-webkit-scrollbar-thumb {
        background: #adb5bd;
        border-radius: 10px;
    }

        .menu-container::-webkit-scrollbar-thumb:hover {
            background: #6c757d;
        }
    /* Responsive */
    @@media (max-width: 768px) {
        .user-type-bar {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .stats-box {
            width: 100%;
            justify-content: space-around;
        }

        .button-chip {
            width: calc(50% - 4px);
        }

        .fixed-save-button {
            bottom: 10px;
            right: 10px;
            left: 10px;
        }

            .fixed-save-button .btn {
                width: 100%;
                justify-content: center;
            }
    }

    @@media (max-width: 576px) {
        .button-chip {
            width: 100%;
        }

        .menu-content {
            flex-direction: column;
        }
    }
</style>
<div class="container-fluid mt-3 permission-wrapper">
    <!-- BAŞLIK -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">
            <i class="fas fa-shield-alt text-primary me-2"></i>
            Buton Yetkilendirme
            <small class="text-muted">(Otomatik Tespit)</small>
        </h5>
    </div>
    <!-- MESAJ -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show py-2 mb-3">
            <i class="fas fa-check-circle me-2"></i>@TempData["Success"]
            <button type="button" class="btn-close py-2" data-bs-dismiss="alert"></button>
        </div>
    }
    <!-- KULLANICI TİPİ VE İSTATİSTİK -->
    <div class="user-type-bar">
        <div class="user-buttons">
            @foreach (var tip in new[] { "Admin", "Musteri", "Bayi", "Distributor" })
            {
                <a href="@Url.Action("Index", new { kullaniciTipi = tip })"
                   class="btn @(Model.SeciliKullaniciTipi == tip ? "btn-primary" : "btn-outline-primary") btn-sm">
                    <i class="fas fa-@(tip.ToLower()) me-1"></i>@tip
                </a>
            }
        </div>
        <div class="stats-box">
            <div class="stat-item">
                <span class="stat-value text-primary">@Model.DetectedButtons.Count</span>
                <span class="stat-label">Buton</span>
            </div>
            <div class="stat-item">
                <span class="stat-value text-success">@Model.GruplanmisButonlar.Count</span>
                <span class="stat-label">Sayfa</span>
            </div>
        </div>
    </div>
    <!-- YETKİ FORMU -->
    <form method="post" action="@Url.Action("Kaydet")" id="permissionForm">
        <input type="hidden" name="kullaniciTipi" value="@Model.SeciliKullaniciTipi" />
        <!-- MENÜ LİSTESİ -->
        <div class="menu-container">
            @{
                int index = 0;
            }
            @foreach (var controller in Model.GruplanmisButonlar.Keys
            .Where(k => !gizlenecekler.Contains(k))
            .OrderBy(k => k))
            {
                var buttons = Model.GruplanmisButonlar[controller];
                var sayfaAdi = sayfaAdlari.ContainsKey(controller) ? sayfaAdlari[controller] : controller;
                <div class="menu-item">
                    <!-- HEADER -->
                    <div class="menu-header" onclick="toggleMenu('@index')">
                        <div class="menu-title">
                            <i class="fas fa-chevron-right" id="icon_@index"></i>
                            <i class="fas fa-file-alt"></i>
                            <span>@sayfaAdi</span>
                            <span class="badge-count">@buttons.Count</span>
                        </div>
                        <div class="menu-actions" onclick="event.stopPropagation()">
                            <button type="button" class="btn btn-xs btn-outline-success controller-tumunu-sec" data-controller="@controller">
                                <i class="fas fa-check"></i> Tümü
                            </button>
                            <button type="button" class="btn btn-xs btn-outline-danger controller-tumunu-kaldir" data-controller="@controller">
                                <i class="fas fa-times"></i> Temizle
                            </button>
                        </div>
                    </div>
                    <!-- CONTENT -->
                    <div id="menu_@index" class="menu-content" style="display: @(index == 0 ? "flex" : "none")">
                        @foreach (var button in buttons.OrderBy(b => b.Action))
                        {
                            string key = $"{button.Controller}|{button.Action}";
                            bool izinVar = Model.ButtonPermissions.ContainsKey(key) && Model.ButtonPermissions[key];
                            // Buton bilgileri
                            string buttonIcon = "fa-circle";
                            string buttonColor = "secondary";
                            string buttonText = button.Action;
                            string renkClass = "secondary";
                            if (butonAdlari.ContainsKey(button.Action.ToLower()))
                            {
                                var butonBilgi = butonAdlari[button.Action.ToLower()];
                                buttonIcon = butonBilgi.Icon;
                                buttonColor = butonBilgi.Renk;
                                buttonText = butonBilgi.Ad;
                                renkClass = butonBilgi.Renk;
                            }
                            <div class="button-chip @(izinVar ? "izinli" : "")">
                                <input class="form-check-input button-checkbox"
                                       type="checkbox"
                                       name="seciliIzinler"
                                       value="@key"
                                       id="chk_@(controller)_@(button.Action)"
                                       data-controller="@controller"
                                @(izinVar ? "checked" : "") />
                                <label for="chk_@(controller)_@(button.Action)">
                                    <i class="fas @buttonIcon text-@renkClass"></i>
                                    <span class="action-badge bg-@renkClass">@buttonText</span>
                                </label>
                            </div>
                        }
                    </div>
                </div>
                index++;
            }
        </div>
        <!-- STICKY KAYDET BUTONU -->
        <div class="sticky-save-container">
            <button type="submit" class="btn btn-primary btn-lg px-5">
                <i class="fas fa-save me-2"></i>Yetkileri Kaydet
            </button>
        </div>
    </form>
</div>
@section Script {
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // MENU TOGGLE - Pure JavaScript
        function toggleMenu(index) {
            var menu = document.getElementById('menu_' + index);
            var icon = document.getElementById('icon_' + index);
            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'flex';
                icon.className = 'fas fa-chevron-down';
            } else {
                menu.style.display = 'none';
                icon.className = 'fas fa-chevron-right';
            }
        }
        // jQuery hazır olduğunda
        $(document).ready(function() {
            // Tümünü seç
            $('.controller-tumunu-sec').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                var controller = $(this).data('controller');
                var checkboxes = $(`input[type="checkbox"][data-controller="${controller}"]`);
                checkboxes.prop('checked', true);
                checkboxes.each(function() {
                    $(this).closest('.button-chip').addClass('izinli');
                });
            });
            // Tümünü kaldır
            $('.controller-tumunu-kaldir').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                var controller = $(this).data('controller');
                var checkboxes = $(`input[type="checkbox"][data-controller="${controller}"]`);
                checkboxes.prop('checked', false);
                checkboxes.each(function() {
                    $(this).closest('.button-chip').removeClass('izinli');
                });
            });
            // Checkbox değiştiğinde
            $(document).on('change', '.button-checkbox', function() {
                if ($(this).is(':checked')) {
                    $(this).closest('.button-chip').addClass('izinli');
                } else {
                    $(this).closest('.button-chip').removeClass('izinli');
                }
            });
            // Sayfa yüklendiğinde
            $('.button-checkbox:checked').each(function() {
                $(this).closest('.button-chip').addClass('izinli');
            });
        });
    </script>
}