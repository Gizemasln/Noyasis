@{
    ViewData["Title"] = "Lokasyonlarımız";
    Layout = "~/Views/Shared/_LayoutWebUI.cshtml";
}

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
    }

    .map-container {
        width: 100%;
        height: 600px;
        background-color: #e0e0e0;
        border: 1px solid #ddd;
        margin-bottom: 20px;
        position: relative;
    }

    .locations {
        display: flex;
        justify-content: space-around;
        gap: 20px;
        flex-wrap: wrap;
    }

    .location-card {
        background: rgba(255, 255, 255, 0.8);
        border-radius: 8px;
        padding: 20px;
        width: 45%;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
        margin-bottom: 20px;
    }

        .location-card h3 {
            margin: 0 0 10px 0;
            color: #333;
        }

            .location-card h3::after {
                content: " >";
                color: #666;
            }

        .location-card p {
            margin: 5px 0;
            color: #555;
            font-size: 14px;
        }

        .location-card h4 {
            margin: 15px 0 5px 0;
            color: #333;
        }

    .contact {
        display: flex;
        align-items: center;
        margin: 5px 0;
        font-size: 14px;
    }

        .contact::before {
            content: "📞 ";
            margin-right: 5px;
        }

    .email {
        display: flex;
        align-items: center;
        margin: 5px 0;
        font-size: 14px;
    }

        .email::before {
            content: "📧 ";
            margin-right: 5px;
        }

        .email a {
            color: #007bff;
            text-decoration: none;
        }

    /* Highlight still in case */
    .highlight {
        fill: #ff6600 !important;
    }

    .province {
        fill: #afafaf;
        stroke: #ccc;
        stroke-width: 0.5;
        transition: fill 0.3s ease;
    }

        .province:hover {
            fill: #ddd;
        }

    .highlight:hover {
        fill: #ff4500;
    }
</style>

<main class="main">
    <div class="page-title">
        <div class="heading">
            <div class="container">
                <div class="row d-flex justify-content-center text-center">
                    <div class="col-lg-8">
                        <h1>Lokasyonlarımız</h1>
                    </div>
                </div>
            </div>
        </div>
        <nav class="breadcrumbs">
            <div class="container">
                <ol>
                    <li><a href="/Home">Ana Sayfa</a></li>
                    <li class="current">Lokasyonlarımız</li>
                </ol>
            </div>
        </nav>
    </div>
</main>

<div class="container">
    <div class="map-container" id="mapContainer">
        <p>Harita yükleniyor...</p>
    </div>
    <div class="locations">
        @if (ViewBag.LokasyonList != null)
        {
            foreach (var lokasyon in ViewBag.LokasyonList)
            {
                <div class="location-card">
                    <h1>@lokasyon.SehirAdi</h1>
                    <p>@lokasyon.Adres</p>
                    @if (!string.IsNullOrEmpty(lokasyon.Tip))
                    {
                        <h4>@lokasyon.Tip</h4>
                    }
                    @if (!string.IsNullOrEmpty(lokasyon.Telefon))
                    {
                        <div class="contact">@lokasyon.Telefon</div>
                    }
                    @if (!string.IsNullOrEmpty(lokasyon.Email))
                    {
                        <div class="email"><a href="mailto:@lokasyon.Email">@lokasyon.Email</a></div>
                    }
                </div>
            }
        }
        else
        {
            <p>Henüz lokasyon eklenmemiş.</p>
        }
    </div>
</div>

<script>
    // Dinamik lokasyon verilerini al
    var lokasyonlar = @Html.Raw(Json.Serialize(ViewBag.LokasyonList ?? new List<object>()));

    // Tam Türkiye haritası SVG'sini yükle ve dinamik lokasyonları boya (highlight)
    fetch('https://raw.githubusercontent.com/ali-han/Turkey-SVG-Map/main/src/turkey.svg')
        .then(response => response.text())
        .then(svgText => {
            const parser = new DOMParser();
            const svgDoc = parser.parseFromString(svgText, 'image/svg+xml');

            // Tüm illere province class ekle
            const provinces = svgDoc.querySelectorAll('path');
            provinces.forEach(path => {
                path.classList.add('province');
            });

            // Dinamik lokasyonlar için grupları bul ve renklendir (boya)
            lokasyonlar.forEach(lokasyon => {
                const sehirAdi = lokasyon.sehirAdi; // Modeldeki SehirAdi
                const sehirGroup = svgDoc.querySelector(`g[data-city-name="${sehirAdi}"]`);
                if (sehirGroup) {
                    sehirGroup.classList.add('highlight');
                    // Grup içindeki path'leri de highlight et
                    const sehirPaths = sehirGroup.querySelectorAll('path');
                    sehirPaths.forEach(p => p.classList.add('highlight'));
                } else {
                    console.warn(`Haritada '${sehirAdi}' şehri bulunamadı.`);
                }
            });

            // SVG'yi container'a ekle
            const mapContainer = document.getElementById('mapContainer');
            mapContainer.innerHTML = '';
            mapContainer.appendChild(svgDoc.documentElement);
        })
        .catch(error => {
            console.error('Harita yüklenemedi:', error);
            document.getElementById('mapContainer').innerHTML = '<p>Harita yüklenirken hata oluştu. Lütfen sayfayı yenileyin.</p>';
        });
</script>